"""
å†…å®¹æ¸…æ´—å™¨ - å°† AI ç”Ÿæˆçš„ Markdown å†…å®¹è½¬æ¢ä¸ºå°çº¢ä¹¦å‹å¥½çš„çº¯æ–‡æœ¬æ ¼å¼

åŠŸèƒ½ï¼š
1. å»é™¤ Markdown ç²—ä½“ç¬¦å· (**)
2. å»é™¤ Markdown æ ‡é¢˜ç¬¦å· (#)
3. å»é™¤ Markdown åˆ—è¡¨ç¬¦å· (-, *, â€¢)
4. ä¿ç•™æ¢è¡Œå’Œæ®µè½ç»“æ„
5. å¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·
"""

import re
from typing import List, Tuple


class ContentCleaner:
    """å°çº¢ä¹¦å†…å®¹æ¸…æ´—å™¨"""

    # éœ€è¦ä¿ç•™çš„è¡¨æƒ…ç¬¦å·åˆ—è¡¨ï¼ˆå¸¸è§å°çº¢ä¹¦è¡¨æƒ…ï¼‰
    EMOJI_PATTERNS = [
        'ğŸ’¡', 'ğŸ¤–', 'ğŸ§ ', 'ğŸ“', 'ğŸš€', 'âš¡', 'âœ…', 'âŒ', 'âš ï¸', 'ğŸ¯',
        'ğŸ’ª', 'ğŸ”¥', 'ğŸ‘', 'ğŸ‘€', 'ğŸ“š', 'ğŸ’»', 'ğŸ¨', 'ğŸŒŸ', 'â­', 'ğŸ’«',
        'ğŸ‰', 'ğŸŠ', 'ğŸ“¢', 'ğŸ“£', 'ğŸ’¬', 'ğŸ’­', 'ğŸ¤”', 'ğŸ˜Š', 'ğŸ¥°', 'ğŸ˜',
        'ğŸ”¥', 'ğŸ’¯', 'ğŸ‘Œ', 'ğŸ™Œ', 'âœ¨', 'ğŸŒˆ', 'ğŸŒ¸', 'ğŸ€', 'ğŸ', 'ğŸ›ï¸',
        'ğŸ“¦', 'ğŸ·ï¸', 'ğŸ”–', 'ğŸ“Œ', 'ğŸ“', 'âœ‚ï¸', 'ğŸ“', 'ğŸ“', 'ğŸ”§', 'âš™ï¸',
        'ğŸ”¬', 'ğŸ”­', 'ğŸ“¡', 'ğŸ’¾', 'ğŸ“±', 'ğŸ“²', 'âŒš', 'ğŸ–¥ï¸', 'ğŸ’»', 'âŒ¨ï¸',
        'ğŸ–¨ï¸', 'ğŸ–±ï¸', 'ğŸ–²ï¸', 'ğŸ•¹ï¸', 'ğŸ—œï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼',
        'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ',
        'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸', 'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ğŸ•°ï¸',
        'âŒ›', 'â³', 'ğŸ“¡', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ””',
        'ğŸ”•', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¯', 'ğŸ”¢', 'ğŸ”£', 'ğŸ”¤', 'ğŸ”°', 'ğŸ”±', 'ğŸ“›',
        'ğŸ”°', 'âš ï¸', 'ğŸš¸', 'â›”', 'ğŸš«', 'ğŸš³', 'ğŸš­', 'ğŸš¯', 'ğŸš±', 'ğŸš·',
        'ğŸ“µ', 'ğŸ”', 'â˜¢ï¸', 'â˜£ï¸', 'â¬†ï¸', 'â†—ï¸', 'â¡ï¸', 'â†˜ï¸', 'â¬‡ï¸', 'â†™ï¸',
        'â¬…ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†©ï¸', 'â†ªï¸', 'â¤´ï¸', 'â¤µï¸', 'ğŸ”ƒ', 'ğŸ”„',
        'ğŸ”™', 'ğŸ”š', 'ğŸ”›', 'ğŸ”œ', 'ğŸ”', 'ğŸ›', 'âš›ï¸', 'ğŸ•‰ï¸', 'âœ¡ï¸', 'â˜¸ï¸',
        'â˜¯ï¸', 'âœï¸', 'â˜¦ï¸', 'â˜ªï¸', 'â˜®ï¸', 'ğŸ•', 'ğŸ”¯', 'â™ˆ', 'â™‰', 'â™Š',
        'â™‹', 'â™Œ', 'â™', 'â™', 'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'â›',
        'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'â–¶ï¸', 'â©', 'â­ï¸', 'â¯ï¸', 'â—€ï¸', 'âª', 'â®ï¸',
        'ğŸ”¼', 'â«', 'ğŸ”½', 'â¬', 'â¸ï¸', 'â¹ï¸', 'âºï¸', 'âï¸', 'ğŸ¦', 'ğŸ”…',
        'ğŸ”†', 'ğŸ“¶', 'ğŸ“³', 'ğŸ“´', 'â™€ï¸', 'â™‚ï¸', 'âš•ï¸', 'â™¾ï¸', 'â™»ï¸', 'âšœï¸',
        'ğŸ”±', 'ğŸ“›', 'ğŸ”°', 'â­•', 'âœ…', 'â˜‘ï¸', 'âœ”ï¸', 'âœ–ï¸', 'âŒ', 'â',
        'â•', 'â–', 'â—', 'â°', 'â¿', 'ã€½ï¸', 'âœ³ï¸', 'âœ´ï¸', 'â‡ï¸', 'â€¼ï¸',
        'â‰ï¸', 'â“', 'â”', 'â•', 'â—', 'ã€°ï¸', 'Â©ï¸', 'Â®ï¸', 'â„¢ï¸', '#ï¸âƒ£',
        '*ï¸âƒ£', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£',
        '9ï¸âƒ£', 'ğŸ”Ÿ', 'ğŸ” ', 'ğŸ”¡', 'ğŸ”¢', 'ğŸ”£', 'ğŸ”¤', 'ğŸ…°ï¸', 'ğŸ†', 'ğŸ…±ï¸',
        'ğŸ†‘', 'ğŸ†’', 'ğŸ†“', 'â„¹ï¸', 'ğŸ†”', 'â“‚ï¸', 'ğŸ†•', 'ğŸ†–', 'ğŸ…¾ï¸', 'ğŸ†—',
        'ğŸ…¿ï¸', 'ğŸ†˜', 'ğŸ†™', 'ğŸ†š', 'ğŸˆ', 'ğŸˆ‚ï¸', 'ğŸˆ·ï¸', 'ğŸˆ¶', 'ğŸˆ¯', 'ğŸ‰',
        'ğŸˆ¹', 'ğŸˆš', 'ğŸˆ²', 'ğŸ‰‘', 'ğŸˆ¸', 'ğŸˆ´', 'ğŸˆ³', 'ãŠ—ï¸', 'ãŠ™ï¸', 'ğŸˆº',
        'ğŸˆµ', 'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'ğŸŸ¤', 'âš«', 'âšª',
        'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª', 'ğŸŸ«', 'â¬›', 'â¬œ', 'â—¼ï¸',
        'â—»ï¸', 'â—¾', 'â—½', 'â–ªï¸', 'â–«ï¸', 'ğŸ”¶', 'ğŸ”·', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”º',
        'ğŸ”»', 'ğŸ’ ', 'ğŸ”˜', 'ğŸ”³', 'ğŸ”²', 'ğŸ', 'ğŸš©', 'ğŸŒ', 'ğŸ´', 'ğŸ³ï¸',
        'ğŸ³ï¸â€ğŸŒˆ', 'ğŸ³ï¸â€âš§ï¸', 'ğŸ´â€â˜ ï¸', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡¬ğŸ‡§', 'ğŸ‡¯ğŸ‡µ', 'ğŸ‡°ğŸ‡·', 'ğŸ‡«ğŸ‡·', 'ğŸ‡©ğŸ‡ª',
        'ğŸ‡®ğŸ‡¹', 'ğŸ‡·ğŸ‡º', 'ğŸ‡ªğŸ‡º', 'ğŸ‡¨ğŸ‡¦', 'ğŸ‡¦ğŸ‡º', 'ğŸ‡§ğŸ‡·', 'ğŸ‡®ğŸ‡³', 'ğŸ‡²ğŸ‡½', 'ğŸ‡ªğŸ‡¸', 'ğŸ‡¹ğŸ‡­',
        '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ğŸ”Ÿ',
        'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'ğŸŸ¤', 'âš«', 'âšª', 'ğŸŸ£',
        'ğŸŒŸ', 'â­', 'ğŸ’«', 'âœ¨', 'âš¡', 'ğŸ”¥', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’¦', 'ğŸ’§',
        'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ€', 'ğŸ', 'ğŸ†', 'ğŸ…', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰',
        'ğŸ–ï¸', 'ğŸµï¸', 'ğŸ—ï¸', 'ğŸ«', 'ğŸŸï¸', 'ğŸª', 'ğŸ¤', 'ğŸ’ª', 'ğŸ‘', 'ğŸ™Œ',
        'ğŸ‘', 'ğŸ‘', 'ğŸ‘Š', 'âœŠ', 'ğŸ¤›', 'ğŸ¤œ', 'ğŸ¤', 'âœŒï¸', 'ğŸ¤Ÿ', 'ğŸ¤˜',
        'ğŸ¤™', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ‘†', 'ğŸ‘‡', 'â˜ï¸', 'âœ‹', 'ğŸ¤š', 'ğŸ–ï¸', 'ğŸ––',
        'ğŸ‘‹', 'ğŸ¤š', 'ğŸ‘', 'ğŸ™†', 'ğŸ™…', 'ğŸ’', 'ğŸ™‹', 'ğŸ™‡', 'ğŸ¤¦', 'ğŸ¤·',
        'ğŸ’†', 'ğŸ’‡', 'ğŸš¶', 'ğŸƒ', 'ğŸ’ƒ', 'ğŸ•º', 'ğŸ‘¯', 'ğŸ§–', 'ğŸ§˜', 'ğŸ§—',
        'ğŸŠ', 'ğŸ¤¸', 'ğŸ„', 'ğŸš£', 'â›¹ï¸', 'ğŸ‹ï¸', 'ğŸš´', 'ğŸšµ', 'ğŸ¤½', 'ğŸ¤¾',
        'ğŸ¤¹', 'ğŸ›€', 'ğŸ›Œ', 'ğŸ‘­', 'ğŸ‘«', 'ğŸ‘¬', 'ğŸ’', 'ğŸ’‘', 'ğŸ‘ª', 'ğŸ—£ï¸',
        'ğŸ‘¤', 'ğŸ‘¥', 'ğŸ‘£', 'ğŸµ', 'ğŸ’', 'ğŸ¦', 'ğŸ¦§', 'ğŸ¶', 'ğŸ•', 'ğŸ¦®',
        'ğŸ•â€ğŸ¦º', 'ğŸ©', 'ğŸº', 'ğŸ¦Š', 'ğŸ¦', 'ğŸ±', 'ğŸˆ', 'ğŸˆâ€â¬›', 'ğŸ¦', 'ğŸ¯',
        'ğŸ…', 'ğŸ†', 'ğŸ´', 'ğŸ', 'ğŸ¦„', 'ğŸ¦“', 'ğŸ¦Œ', 'ğŸ®', 'ğŸ‚', 'ğŸƒ',
        'ğŸ„', 'ğŸ·', 'ğŸ–', 'ğŸ—', 'ğŸ½', 'ğŸ', 'ğŸ‘', 'ğŸ', 'ğŸª', 'ğŸ«',
        'ğŸ¦™', 'ğŸ¦’', 'ğŸ˜', 'ğŸ¦', 'ğŸ¦›', 'ğŸ­', 'ğŸ', 'ğŸ€', 'ğŸ¹', 'ğŸ°',
        'ğŸ‡', 'ğŸ¿ï¸', 'ğŸ¦”', 'ğŸ¦‡', 'ğŸ»', 'ğŸ»â€â„ï¸', 'ğŸ¨', 'ğŸ¼', 'ğŸ¦¥', 'ğŸ¦¦',
        'ğŸ¦¨', 'ğŸ¦˜', 'ğŸ¦¡', 'ğŸ¾', 'ğŸ¦ƒ', 'ğŸ”', 'ğŸ“', 'ğŸ£', 'ğŸ¤', 'ğŸ¥',
        'ğŸ¦', 'ğŸ§', 'ğŸ•Šï¸', 'ğŸ¦…', 'ğŸ¦†', 'ğŸ¦¢', 'ğŸ¦‰', 'ğŸ¦¤', 'ğŸª¶', 'ğŸ¦©',
        'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¸', 'ğŸŠ', 'ğŸ¢', 'ğŸ¦', 'ğŸ', 'ğŸ²', 'ğŸ‰', 'ğŸ¦•',
        'ğŸ¦–', 'ğŸ³', 'ğŸ‹', 'ğŸ¬', 'ğŸ¦­', 'ğŸŸ', 'ğŸ ', 'ğŸ¡', 'ğŸ¦ˆ', 'ğŸ™',
        'ğŸš', 'ğŸŒ', 'ğŸ¦‹', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸª²', 'ğŸ', 'ğŸ¦—', 'ğŸª³',
        'ğŸ•·ï¸', 'ğŸ¦‚', 'ğŸ¦Ÿ', 'ğŸª°', 'ğŸª±', 'ğŸ¦ ', 'ğŸ’', 'ğŸŒ¸', 'ğŸ’®', 'ğŸµï¸',
        'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒ·', 'ğŸŒ±', 'ğŸª´', 'ğŸŒ²', 'ğŸŒ³',
        'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ¾', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ‡',
        'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ¥­', 'ğŸ', 'ğŸ', 'ğŸ',
        'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ«', 'ğŸ¥', 'ğŸ…', 'ğŸ«’', 'ğŸ¥¥', 'ğŸ¥‘', 'ğŸ†',
        'ğŸ¥”', 'ğŸ¥•', 'ğŸŒ½', 'ğŸŒ¶ï¸', 'ğŸ«‘', 'ğŸ¥’', 'ğŸ¥¬', 'ğŸ¥¦', 'ğŸ§„', 'ğŸ§…',
        'ğŸ„', 'ğŸ¥œ', 'ğŸŒ°', 'ğŸ', 'ğŸ¥', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ¥¯', 'ğŸ¥', 'ğŸ§‡',
        'ğŸ§€', 'ğŸ–', 'ğŸ—', 'ğŸ¥©', 'ğŸ¥“', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸŒ­', 'ğŸ¥ª',
        'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥™', 'ğŸ§†', 'ğŸ¥š', 'ğŸ³', 'ğŸ¥˜', 'ğŸ²', 'ğŸ«•',
        'ğŸ¥£', 'ğŸ¥—', 'ğŸ¿', 'ğŸ§ˆ', 'ğŸ§‚', 'ğŸ¥«', 'ğŸ±', 'ğŸ˜', 'ğŸ™', 'ğŸš',
        'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ ', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¥®', 'ğŸ¡',
        'ğŸ¥Ÿ', 'ğŸ¥ ', 'ğŸ¥¡', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦‘', 'ğŸ¦ª', 'ğŸ¦', 'ğŸ§',
        'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ‚', 'ğŸ°', 'ğŸ§', 'ğŸ¥§', 'ğŸ«', 'ğŸ¬', 'ğŸ­',
        'ğŸ®', 'ğŸ¯', 'ğŸ¼', 'ğŸ¥›', 'â˜•', 'ğŸ«–', 'ğŸµ', 'ğŸ¶', 'ğŸ¾', 'ğŸ·',
        'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ¥ƒ', 'ğŸ¥¤', 'ğŸ§‹', 'ğŸ§ƒ', 'ğŸ§‰',
        'ğŸ§Š', 'ğŸ¥¢', 'ğŸ½ï¸', 'ğŸ´', 'ğŸ¥„', 'ğŸ”ª', 'ğŸº', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ',
        'ğŸŒ', 'ğŸ—ºï¸', 'ğŸ—¾', 'ğŸ§­', 'ğŸ”ï¸', 'â›°ï¸', 'ğŸŒ‹', 'ğŸ—»', 'ğŸ•ï¸', 'ğŸ–ï¸',
        'ğŸœï¸', 'ğŸï¸', 'ğŸï¸', 'ğŸŸï¸', 'ğŸ›ï¸', 'ğŸ—ï¸', 'ğŸ§±', 'ğŸ˜ï¸', 'ğŸšï¸', 'ğŸ ',
        'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸ©', 'ğŸª', 'ğŸ«',
        'ğŸ¬', 'ğŸ­', 'ğŸ¯', 'ğŸ°', 'ğŸ’’', 'ğŸ—¼', 'ğŸ—½', 'â›ª', 'ğŸ•Œ', 'ğŸ›•',
        'ğŸ•', 'â›©ï¸', 'ğŸ•‹', 'â›²', 'ğŸ›¤ï¸', 'ğŸ›£ï¸', 'ğŸ—¾', 'ğŸ‘', 'ğŸï¸', 'ğŸŒ…',
        'ğŸŒ„', 'ğŸŒ ', 'ğŸ‡', 'ğŸ†', 'ğŸŒ‡', 'ğŸŒ†', 'ğŸ™ï¸', 'ğŸŒƒ', 'ğŸŒŒ', 'ğŸŒ‰',
        'ğŸŒ', 'âŒš', 'ğŸ“±', 'ğŸ“²', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'ğŸ–±ï¸', 'ğŸ–²ï¸',
        'ğŸ•¹ï¸', 'ğŸ—œï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹',
        'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸',
        'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ğŸ•°ï¸', 'âŒ›', 'â³', 'ğŸ“¡',
        'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ””', 'ğŸ”•', 'ğŸ“¢', 'ğŸ“£',
        'ğŸ“¯', 'ğŸ”¢', 'ğŸ”£', 'ğŸ”¤', 'ğŸ”°', 'ğŸ”±', 'ğŸ“›', 'ğŸ”°', 'âš ï¸', 'ğŸš¸',
    ]

    @classmethod
    def clean_for_xiaohongshu(cls, content: str) -> str:
        """
        æ¸…æ´—å†…å®¹ï¼Œä½¿å…¶é€‚åˆå°çº¢ä¹¦å‘å¸ƒ

        Args:
            content: åŸå§‹å†…å®¹ï¼ˆå¯èƒ½åŒ…å« Markdown æ ¼å¼ï¼‰

        Returns:
            æ¸…æ´—åçš„çº¯æ–‡æœ¬å†…å®¹
        """
        if not content:
            return ""

        # æŒ‰é¡ºåºåº”ç”¨æ¸…æ´—è§„åˆ™
        content = cls._remove_markdown_bold(content)
        content = cls._remove_markdown_headers(content)
        content = cls._remove_markdown_lists(content)
        content = cls._remove_markdown_code(content)
        content = cls._remove_markdown_links(content)
        content = cls._clean_numbered_lists(content)
        content = cls._normalize_spacing(content)
        content = cls._preserve_emojis(content)

        return content.strip()

    @classmethod
    def _remove_markdown_bold(cls, text: str) -> str:
        """å»é™¤ Markdown ç²—ä½“ç¬¦å· (**æ–‡æœ¬**)"""
        # å¤„ç† **ç²—ä½“**
        text = re.sub(r'\*\*([^*]+)\*\*', r'\1', text)
        # å¤„ç† __ç²—ä½“__
        text = re.sub(r'__([^_]+)__', r'\1', text)
        # å¤„ç† *æ–œä½“*
        text = re.sub(r'\*([^*]+)\*', r'\1', text)
        # å¤„ç† _æ–œä½“_
        text = re.sub(r'_([^_]+)_', r'\1', text)
        return text

    @classmethod
    def _remove_markdown_headers(cls, text: str) -> str:
        """å»é™¤ Markdown æ ‡é¢˜ç¬¦å· (# æ ‡é¢˜)"""
        lines = text.split('\n')
        cleaned_lines = []

        for line in lines:
            # ç§»é™¤å¼€å¤´çš„ # ç¬¦å·ï¼ˆæœ€å¤š6ä¸ªï¼‰
            line = re.sub(r'^(#{1,6})\s+', '', line)
            cleaned_lines.append(line)

        return '\n'.join(cleaned_lines)

    @classmethod
    def _remove_markdown_lists(cls, text: str) -> str:
        """å»é™¤ Markdown åˆ—è¡¨ç¬¦å·"""
        lines = text.split('\n')
        cleaned_lines = []

        for line in lines:
            # ç§»é™¤ - å¼€å¤´çš„æ— åºåˆ—è¡¨
            line = re.sub(r'^[-*]\s+', '', line)
            # ç§»é™¤ â€¢ å¼€å¤´çš„æ— åºåˆ—è¡¨
            line = re.sub(r'^â€¢\s+', '', line)
            cleaned_lines.append(line)

        return '\n'.join(cleaned_lines)

    @classmethod
    def _remove_markdown_code(cls, text: str) -> str:
        """å»é™¤ Markdown ä»£ç å—ç¬¦å·"""
        # ç§»é™¤ ```ä»£ç å—```
        text = re.sub(r'```[\s\S]*?```', '', text)
        # ç§»é™¤ `è¡Œå†…ä»£ç `
        text = re.sub(r'`([^`]+)`', r'\1', text)
        return text

    @classmethod
    def _remove_markdown_links(cls, text: str) -> str:
        """å»é™¤ Markdown é“¾æ¥æ ¼å¼ï¼Œåªä¿ç•™æ–‡å­—"""
        # [æ–‡å­—](é“¾æ¥) -> æ–‡å­—
        text = re.sub(r'\[([^\]]+)\]\([^\)]+\)', r'\1', text)
        return text

    @classmethod
    def _clean_numbered_lists(cls, text: str) -> str:
        """æ¸…æ´—æ•°å­—åˆ—è¡¨ï¼Œä½¿å…¶æ›´è‡ªç„¶"""
        lines = text.split('\n')
        cleaned_lines = []

        for line in lines:
            # å°† "1ï¸âƒ£" "2ï¸âƒ£" ç­‰è½¬æ¢ä¸ºæ›´è‡ªç„¶çš„æ ¼å¼
            # å°† "1." "2." ç­‰åˆ—è¡¨ç¬¦å·å»é™¤ï¼Œä¿ç•™æ•°å­—
            line = re.sub(r'^(\d+)\.\s+', r'\1. ', line)
            cleaned_lines.append(line)

        return '\n'.join(cleaned_lines)

    @classmethod
    def _normalize_spacing(cls, text: str) -> str:
        """è§„èŒƒåŒ–ç©ºæ ¼å’Œæ¢è¡Œ"""
        # å°†å¤šä¸ªè¿ç»­ç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼
        text = re.sub(r' +', ' ', text)
        # å°†å¤šä¸ªè¿ç»­æ¢è¡Œæ›¿æ¢ä¸ºæœ€å¤šä¸¤ä¸ªæ¢è¡Œï¼ˆä¿ç•™æ®µè½ç»“æ„ï¼‰
        text = re.sub(r'\n\n\n+', '\n\n', text)
        # å»é™¤è¡Œé¦–å°¾ç©ºæ ¼
        lines = text.split('\n')
        lines = [line.strip() for line in lines]
        return '\n'.join(lines)

    @classmethod
    def _preserve_emojis(cls, text: str) -> str:
        """ç¡®ä¿è¡¨æƒ…ç¬¦å·è¢«ä¿ç•™ï¼ˆä¸åšä»»ä½•å¤„ç†ï¼‰"""
        # è¿™ä¸ªæ–¹æ³•å®é™…ä¸Šä¸åšä»»ä½•äº‹ï¼Œåªæ˜¯ä½œä¸ºå ä½ç¬¦
        # è¡¨æƒ…ç¬¦å·ä¼šåœ¨å‰é¢çš„å¤„ç†ä¸­è¢«ä¿ç•™
        return text

    @classmethod
    def extract_tags(cls, content: str) -> List[str]:
        """
        ä»å†…å®¹ä¸­æå–æ ‡ç­¾

        Args:
            content: å†…å®¹æ–‡æœ¬

        Returns:
            æ ‡ç­¾åˆ—è¡¨ï¼ˆä¸åŒ…å« # ç¬¦å·ï¼‰
        """
        tags = []
        # åŒ¹é… #æ ‡ç­¾ æ ¼å¼
        matches = re.findall(r'#([^\s#]+)', content)

        for tag in matches:
            # æ¸…ç†æ ‡ç­¾ï¼ˆç§»é™¤å¯èƒ½çš„åç¼€æ ‡ç‚¹ï¼‰
            clean_tag = re.sub(r'[ã€‚ï¼ï¼Ÿï¼Œã€ï¼›ï¼š""\'\(\)\[\]{}]', '', tag)
            if clean_tag and len(clean_tag) <= 20:
                tags.append(f'#{clean_tag}')

        return tags

    @classmethod
    def format_xiaohongshu_tags(cls, tags: List[str]) -> str:
        """
        æ ¼å¼åŒ–å°çº¢ä¹¦æ ‡ç­¾

        Args:
            tags: æ ‡ç­¾åˆ—è¡¨

        Returns:
            æ ¼å¼åŒ–åçš„æ ‡ç­¾å­—ç¬¦ä¸²
        """
        if not tags:
            return ""

        # ç¡®ä¿æ¯ä¸ªæ ‡ç­¾éƒ½æœ‰ # å‰ç¼€
        formatted_tags = []
        for tag in tags:
            if not tag.startswith('#'):
                tag = f'#{tag}'
            formatted_tags.append(tag)

        return ' '.join(formatted_tags)

    @classmethod
    def preview_cleaned_content(cls, original: str, cleaned: str) -> str:
        """
        ç”Ÿæˆæ¸…æ´—å‰åå¯¹æ¯”é¢„è§ˆ

        Args:
            original: åŸå§‹å†…å®¹
            cleaned: æ¸…æ´—åå†…å®¹

        Returns:
            å¯¹æ¯”é¢„è§ˆæ–‡æœ¬
        """
        preview = f"""
{'='*60}
ğŸ“ å†…å®¹æ¸…æ´—é¢„è§ˆ
{'='*60}

ã€åŸå§‹å†…å®¹ã€‘
{original[:200]}{'...' if len(original) > 200 else ''}

ã€æ¸…æ´—åå†…å®¹ã€‘
{cleaned[:200]}{'...' if len(cleaned) > 200 else ''}

{'='*60}
"""
        return preview


# ä¾¿æ·å‡½æ•°
def clean_content(content: str) -> str:
    """ä¾¿æ·çš„å†…å®¹æ¸…æ´—å‡½æ•°"""
    return ContentCleaner.clean_for_xiaohongshu(content)


def extract_tags(content: str) -> List[str]:
    """ä¾¿æ·çš„æ ‡ç­¾æå–å‡½æ•°"""
    return ContentCleaner.extract_tags(content)


if __name__ == "__main__":
    # æµ‹è¯•ç”¨ä¾‹
    test_content = """
# AIå·¥å…·æ¨è

**5æ¬¾AIæ‘˜è¦ç¥å™¨**âš¡æ•ˆç‡ç¿»å€ï¼

è¿˜åœ¨ä¸ºé•¿æ–‡å‘æ„å—ï¼ŸğŸ¤¯

1ï¸âƒ£ **Kimi Chat**ï¼š20ä¸‡å­—é•¿æ–‡ä¸€é”®æ€»ç»“ ğŸ“„
2ï¸âƒ£ **è±†åŒ…**ï¼šç½‘é¡µã€è§†é¢‘éƒ½æ‹¿ä¸‹ ğŸ¬
3ï¸âƒ£ **Perplexity AI**ï¼šä¿¡æ¯æ¥æºä¸€ç›®äº†ç„¶ ğŸ”

èµ¶ç´§ç ä½ï¼Œé«˜æ•ˆå·¥ä½œå°±é å®ƒä»¬äº†ï¼ğŸ’ª

#AIå·¥å…· #æ•ˆç‡ç¥å™¨ #æ‰“å·¥äººå¿…å¤‡
    """

    cleaner = ContentCleaner()
    cleaned = cleaner.clean_for_xiaohongshu(test_content)

    print(cleaner.preview_cleaned_content(test_content, cleaned))
    print("\nã€å®Œæ•´æ¸…æ´—åå†…å®¹ã€‘")
    print(cleaned)
    print("\nã€æå–çš„æ ‡ç­¾ã€‘")
    print(cleaner.format_xiaohongshu_tags(cleaner.extract_tags(test_content)))
