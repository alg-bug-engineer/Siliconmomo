基于目前的系统状态（v0.6 稳定版）和你提出的新需求，我们即将进入 **Project SiliconMomo v2.0：创作者时代**。

这一阶段的核心挑战从“拟人化互动”升级为**“内容生产闭环”**。根据你的四个核心思考点，我为你梳理了下一版本的详细优化功能点与架构设计。

---

# Project SiliconMomo v2.0 迭代规划：创作者觉醒

## 核心目标

打造一个能够**自主选题、素材积累、视觉创作、自动发布**的全链路内容创作者智能体。

---

## 1. 功能点梳理 (Feature List)

### 模块一：素材库与记忆系统 (对应问题 1 & 3)

目前的 `recorder` 只是记录日志，需要升级为**知识库 (Knowledge Base)**。

* **[新增] 灵感收集器 (Inspiration Collector):**
* **深度阅读归档：** 当触发 `_deep_mode_interact`（深度模式）时，不仅评论，还要将该帖子的 `标题`、`正文`、`高赞评论` 以及 `LLM的分析结果` 存入本地数据库（JSON 或 SQLite）。
* **标签化管理：** 存储时自动打标（如：`#部署教程`、`#行业观点`、`#工具推荐`），便于后续检索。


* **[优化] 联网信源聚合 (Web Information Retrieval):**
* 集成 `Google Search` 工具（或 GLM 的联网能力），不仅仅依赖历史浏览。
* **场景：** 当决定写“DeepSeek”相关话题时，先去搜索最新的技术文档或新闻，补充到素材库中。



### 模块二：视觉创作工坊 (对应问题 2)

关于生图，你的两个思路分析非常精准。考虑到稳定性与拟人化，建议采用**混合策略**：

* **[首选] API 生图 (CogView-4 / Midjourney Proxy):**
* **理由：** 稳定性高，不仅可以控制 Prompt，还能通过 API 回传图片直接保存到本地，便于 Playwright 上传。
* **实现：** 在 `core/` 下新增 `image_generator.py`，封装 CogView-4 调用。


* **[备选] 浏览器内生图 (Gemini/ChatGPT web):**
* **理由：** 效果好，但风险极大（多一个 Tab 就多一份上下文丢失、弹窗、风控的风险）。
* **建议：** MVP 阶段先放弃此方案，除非 API 效果实在无法接受。


* **[增强] 图片深加工 (Image Processing):**
* **去AI味：** 使用 `PIL` (Python Imaging Library) 给生成的图片自动添加噪点、轻微裁剪、甚至加上小红书风格的滤镜/文字贴纸。



### 模块三：选题与内容生成 (对应问题 3 & 4)

解决“写什么”和“怎么写”的问题。

* **[新增] 选题委员会 (Editorial Board):**
* **热点追踪：** 分析 `Inspiration Collector` 中最近收集的高频关键词（如最近 50 个浏览记录里“DeepSeek”出现了 20 次，那就定这个题）。
* **周期轮转：** 设定固定栏目（如：周一发教程，周三发观点，周五发工具），由 `Scheduler` 调度。


* **[新增] 爆款写作 Agent (Copywriter):**
* **仿写能力：** 输入 3 篇同类高赞笔记，让 GLM-4 学习其结构（“痛点+解决方案+情绪价值”），输出新文案。
* **多源融合：** 融合“历史笔记素材”+“联网搜索新知”+“Momo的人设口吻”生成最终文案。



### 模块四：发布执行 (Execution)

* **[新增] 发布动作链 (Posting Action):**
* 实现“点击发布 -> 上传图片 -> 填写标题正文 -> 选话题标签 -> 艾特用户 -> 发布”的完整 UI 操作自动化。
* **难点攻克：** 文件上传对话框的处理（Playwright 的 `set_input_files` 在 CDP 模式下通常有效，但需测试）。



---

## 2. 架构调整 (Architecture Changes)

我们需要引入一个新的角色：**Creator (创作者)**，并升级现有的 **Brain (大脑)**。

```text
SiliconMomo/
├── data/
│   └── inspiration.db       # [新增] 素材数据库 (SQLite/JSON)
├── core/
│   ├── llm_client.py        # [升级] 增加写作、选题 Prompt
│   ├── image_generator.py   # [新增] 对接 CogView-4
│   └── knowledge_base.py    # [新增] 管理素材存取
├── actions/
│   ├── interaction.py       # (Worker) 负责浏览、互动、采集
│   └── publisher.py         # [新增] (Worker) 负责上传、发布
├── main.py                  # [修改] 增加“创作模式”调度
└── assets/                  # [新增] 存放生成的图片文件

```

---

## 3. 下一步实施路线图 (Roadmap)

建议分三步走，不要试图一次性完成：

### 第一阶段：素材积累 (The Collector)

* **目标：** 让 Momo 在浏览时“不仅看，还能记”。
* **任务：**
1. 建立 `data/inspiration.json`。
2. 修改 `interaction.py`，在 `_deep_mode_interact` 中，将优质内容写入 JSON。
3. 验证数据积累的质量（是否收集到了有用的信息）。



### 第二阶段：内容生产 (The Writer & Artist)

* **目标：** 解决“写什么”和“配什么图”。
* **任务：**
1. 开发 `knowledge_base.py`，实现从 JSON 中分析热点话题。
2. 对接 CogView-4，实现根据文案自动生成封面图（如：“一张极简风格的书桌，电脑屏幕显示代码，赛博朋克光效”）。
3. 调试 GLM-4 的写作 Prompt，确保生成的笔记像“Momo”写的，而不是 GPT 写的。



### 第三阶段：自动发布 (The Publisher)

* **目标：** 打通最后一步上传。
* **任务：**
1. 开发 `publisher.py`，攻克小红书网页版发布页面的 DOM 操作。
2. 集成全流程：浏览积累 -> 触发创作阈值 -> 生成内容 -> 自动发布。



---

## 4. 潜在风险预判

1. **图片版权与风控：** AI 生成的图容易被平台识别并限流。
* *对策：* 必须加滤镜、噪点，或者混入一些非 AI 的素材（如固定的个人 Logo）。


2. **发布频率：** 新号突然发帖过频会被关小黑屋。
* *对策：* 严格控制频率，初期建议 **2-3 天发一篇**，发布动作必须间隔浏览动作 30 分钟以上。


3. **文件上传兼容性：** CDP 模式下，有时候操作系统的文件选择框很难控制。
* *对策：* Playwright 的 `page.set_input_files()` 通常有效，如果失效，可能需要借助 `pyautogui` 进行更底层的 OS 级操作（但这会破坏 headless 能力，不过 CDP 本身就是有头的，所以可行）。
