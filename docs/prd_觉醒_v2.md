这份文档是基于 **Project SiliconMomo v2.0** 的深度迭代版（v2.1）。

我们在这一版中做出了重大战略调整：**放弃 API 生图，转向更具挑战但效果更好的“即梦”网页自动化；放弃“资源搬运工”的人设，转向“技术策展人/评论员”；并大幅升级维修工以应对复杂的发布流程。**

---

# Project SiliconMomo v2.1：创作者与艺术家 (The Creator & The Artist)

**文档版本：** v2.1
**核心变更：** 账号定位重塑、即梦(Jimeng)网页自动化、发布流程的熔断与修复。

---

## 1. 账号定位与内容策略 (Positioning & Strategy)

针对你提出的“资源贴难做”的问题，我们必须调整策略。Momo 不能是一个“假装有资源的骗子”，而应该是一个**“具备高审美与技术洞察的观察者”**。

### 1.1 账号人设 (Persona Refinement)

* **定位：** **AI 技术策展人 / 极客审美博主**。
* **口吻：** 冷静、客观、偶尔犀利（吐槽技术难点），审美在线。
* **核心价值：** 帮用户过滤信息噪音，总结技术要点，提供情绪价值。

### 1.2 内容类型矩阵 (Content Matrix)

基于 `Inspiration Collector` 收集到的关键词（如 DeepSeek、ComfyUI、Agent），我们只生产以下三类内容，**规避“虚假资源”风险**：

| 类型 | 描述 | 数据来源 | 写作逻辑 (LLM Prompt) |
| --- | --- | --- | --- |
| **A. 技术情报/资讯** | "DeepSeek V3 到底强在哪？全网测评总结" | 聚合素材库中 3-5 篇同类热门贴的观点。 | **RAG 摘要：** 提取多篇素材的核心论点，去重、重组，输出一篇“省流版”总结。 |
| **B. 观点/吐槽** | "本地部署大模型，我踩过的 3 个坑" | 基于素材库中的负面/困难评论 + 标题。 | **情绪共鸣：** 提取素材中的“痛点”，以第一人称模拟“我也遇到了”，引发共鸣。 |
| **C. 审美/桌搭** | "深夜 coding，AI 是最好的陪伴" | 纯视觉导向，依赖即梦生成的高质量图。 | **氛围感：** 文案简短，重点在于“配图+BGM感”，利用素材库中的高赞短文案风格。 |

**❌ 放弃类型：** 直接分享网盘链接的资源贴（因为无法交付真实文件）。

---

## 2. 核心架构升级 (Architecture Evolution)

为了支撑上述内容，我们需要引入两个全新的 **Worker**，并升级 **Recovery Agent**。

```text
SiliconMomo/
├── core/
│   ├── artist.py            # [新增] 美术师 (操作即梦 Tab)
│   ├── writer.py            # [新增] 笔杆子 (负责 RAG 和文案生成)
│   ├── recovery.py          # [升级] 增加对发布失败和生图失败的处理
│   └── knowledge_base.py    # [现有] 素材库
├── actions/
│   ├── publisher.py         # [新增] 发布员 (操作小红书发布页)
│   └── interaction.py       # [现有] 浏览员
└── main.py                  # [修改] 调度中心

```

---

## 3. 详细功能模块设计

### 3.1 笔杆子 (The Writer) - `core/writer.py`

负责解决“写什么”。

* **热点聚类：** 从 `inspiration.json` 中读取最近 24 小时的素材，统计高频关键词。
* **策略路由：**
* 如果关键词是具体的工具（如 DeepSeek） -> 触发 **Type A (技术情报)**。
* 如果关键词是宽泛的概念（如 程序员、加班） -> 触发 **Type C (审美)**。


* **创作 Prompt：**
> "你是一个小红书技术博主。请阅读以下 3 篇关于 [DeepSeek] 的笔记摘要：[Content 1]...[Content 3]。请忽略原作者身份，以第三人称视角，为我总结出一篇 300 字的'避坑指南'。要求：分点陈述，口语化，带 Emoji，不要出现任何链接。"



### 3.2 美术师 (The Artist) - `core/artist.py`

负责解决“配什么图”。**这是本版本的技术难点（即梦网页自动化）。**

* **工作流：**
1. **Tab 切换：** 检查浏览器是否已打开 `jimeng.jianying.com`，未打开则新建并跳转。
2. **Prompt 转换：** 将 `Writer` 生成的中文标题，通过 LLM 转化为适合即梦的绘画 Prompt（例如：“极简主义风格，Macbook Pro 屏幕显示 DeepSeek 代码，赛博朋克光效，3D 渲染，8k 分辨率”）。
3. **生成操作：**
* 定位输入框 -> 填入 Prompt。
* 选择比例 -> **3:4** (必须写死，适配小红书)。
* 点击生成 -> **轮询等待** (检测进度条或结果图出现)。


4. **下载闭环：** 点击大图 -> 触发下载 -> 监听 `page.on("download")` -> 保存至 `assets/images/`。



### 3.3 发布员 (The Publisher) - `actions/publisher.py`

负责“发出去”。

* **DOM 操作链：**
* 点击侧边栏“发布”按钮。
* **上传处理：** 使用 `page.set_input_files()` 上传刚才下载的图片。
* **填空：** 填入标题、正文。
* **标签：** 输入 `#` + 关键词 -> 等待下拉框 -> 回车选中。
* **发布：** 点击发布 -> 等待“发布成功”提示。



---

## 4. 维修工的进阶 (Upgraded Recovery)

发布流程非常脆弱（弹窗、卡顿、上传失败），**维修工 (RecoveryAgent)** 必须深度介入。

### 新增维修策略：

| 错误场景 | 维修动作 | 逻辑描述 |
| --- | --- | --- |
| **即梦生成超时** | **重试/降级** | 如果 60s 未生成，刷新即梦页面。如果连续失败 2 次，标记该任务失败，放弃发帖，只浏览。 |
| **即梦弹出滑块** | **人工呼叫** | 检测到滑块元素 -> 暂停脚本 -> 播放提示音/弹窗 -> 等待人工手动滑过 -> 回车继续。 |
| **发布页卡死** | **保存草稿** | 如果卡在编辑页发不出去，尝试点击“取消” -> “保存草稿”。下次启动优先检查草稿箱。 |
| **上传框无响应** | **页面刷新** | 上传图片 5s 后无预览图 -> 刷新发布页 -> 重新触发上传流程。 |

---

## 5. 开发迭代计划 (Revised Roadmap)

我们不求一次做完，分三个子版本迭代：

### Phase 2.1: 笔杆子与美术师 (The Brain & The Eye)

* **目标：** 不发帖，只生成。跑通“读取素材 -> 生成文案 -> 控制即梦生图 -> 本地保存”的闭环。
* **产物：** 本地文件夹里出现了一张张精美的图片和对应的 `.txt` 文案。
* **测试重点：** 即梦的 DOM 选择器稳定性、滑块的人工接管流程。

### Phase 2.2: 发布员上线 (The Hand)

* **目标：** 将本地素材发出去。
* **产物：** 能够自动点击发布、上传 Phase 2.1 生成的图片。
* **测试重点：** 小红书发布页的 `input[type=file]` 交互，以及标签的选择逻辑。

### Phase 2.3: 全链路联调与熔断

* **目标：** 浏览与创作混合运行。
* **逻辑：** 设定 `Scheduler`，例如：浏览 30 分钟 -> 触发一次创作 -> 成功发布 -> 继续浏览。
* **重点：** 维修工在两个 Tab 之间切换时的异常处理（如：在即梦报错了，能不能切回小红书继续刷？）。

---

## 6. 风险提示与对策

1. **即梦的动态 Class：**
* *对策：* 尽量使用 `xpath` 包含文本匹配（如 `//button[contains(text(), '生成')]`）或相对定位，减少对随机 Class 名的依赖。


2. **小红书图文重复：**
* *对策：* 虽然是 AI 生图，但为了保险，建议在上传前用 Python `PIL` 库给图片随机微调一下对比度，或者加一个肉眼不可见的噪点水印。


3. **多 Tab 内存泄漏：**
* *对策：* 即梦是个内存大户。建议每生成 3-5 次图后，在代码逻辑里执行一次 `page.reload()` 释放显存/内存。



---

这份文档确立了我们 **“利用工具而非模仿工具”** 的技术路线。如果确认无误，我们将从 **Phase 2.1** 开始，编写 `artist.py`，挑战即梦的网页自动化。