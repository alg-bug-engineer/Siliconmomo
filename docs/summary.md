这份文档汇总了 **Project SiliconMomo (硅基Momo)** 从起步到当前 v2.2 版本的完整技术演进、架构设计、核心决策与未来规划。这是一份关于构建“L4级自动驾驶社交智能体”的工程白皮书。

---

# 📘 Project SiliconMomo：全链路拟人化社交智能体工程文档

**版本：** v2.2 (The Autonomous Creator)
**核心定义：** 基于 Chrome CDP 协议与大模型驱动的 Web 智能体，具备感知（浏览）、认知（思考）、创作（生图/文案）、行动（发布）及自愈（动态修复）能力。

---

## 1. 项目愿景与定位

### 1.1 核心目标

构建一个能够像真人一样在小红书生存的 AI。

* **拒绝：** 传统的 API 爬虫、机械的群控脚本。
* **追求：** 拟人化的浏览轨迹、基于理解的互动、高质量的原创内容生产、以及面对网页变动时的自我适应能力。

### 1.2 账号人设 (Persona)

* **身份：** AI 杂货店博主 "Momo"，专注于推荐各类 AI 工具、浏览器插件、效率神器。
* **内容策略：** 不做虚假资源搬运。专注于 AI 工具测评、使用教程、效率提升技巧，帮助打工人和创作者提高工作效率。

---

## 2. 技术架构演进 (Architecture Evolution)

### Phase 1: 消费者 (The Consumer) —— v1.0

* **核心功能：** 浏览信息流、随机点赞收藏、基于 GLM-4 对帖子内容进行语义分析并发表评论。
* **技术突破：**
* **CDP (Connect over CDP):** 放弃 `browser.launch`，直接接管用户已登录的 Chrome 浏览器，复用 Cookie 和指纹，彻底绕过登录验证码。
* **拟人化动作：** 使用贝塞尔曲线鼠标轨迹和随机阅读时长，通过风控。
* **漏斗模型：** 引入“懒人模式” (60% 随机划过) vs “深思模式” (40% 深度分析)，模拟真实人类的注意力稀缺。



### Phase 2: 创作者 (The Creator) —— v2.0 & v2.1

* **核心功能：** 将深度阅读的高质量帖子存入“素材库”，基于素材生成新文案，利用 **即梦 (Jimeng)** 网页版自动生成配图。
* **技术突破：**
* **RAG (检索增强生成):** 建立 `inspiration.json`，让写作基于真实的热点数据。
* **Web Automation (Jimeng):** 攻克了复杂的即梦生图流程（输入、等待渲染、下载）。



### Phase 3: 自动驾驶发布者 (The Publisher) —— v2.2 (Current)

* **核心功能：** 自动上传图片、填写标题/正文/标签、发布笔记。
* **技术突破：**
* **SmartLocator (L3 级辅助):** 当静态选择器失效时，将 DOM 结构发给 GLM，让 AI 现场分析元素位置。
* **God-Mode Recovery (L4 级自愈):** 当遇到未知错误（如未切换 Tab），AI 动态编写 Python 代码并 `exec()` 执行，现场修复故障。



---

## 3. 核心模块与实现细节

### 3.1 核心中枢 (Core)

* **`llm_client.py`:** 对接智谱 GLM-4.6，负责语义理解、评论生成、代码生成。
* **`recorder.py`:** 结构化日志系统，负责记录所有行为、截图报错现场。
* **`dom_helper.py`:** **DOM 瘦身算法**。在发送给 LLM 前，清洗掉 script/style/svg 等噪音，只保留骨架，防止 Token 爆炸。

### 3.2 工人集群 (Workers)

1. **`InteractionAgent` (浏览员):**
* 负责刷 Feed 流。
* **亮点：** 实现了“环境自检”，防止脚本跑偏到其他网站。


2. **`WriterAgent` (笔杆子):**
* 从 `inspiration.json` 读取种子素材。
* Prompt 设计：要求生成 JSON 格式，包含标题、正文、以及**英文的绘画提示词**。


3. **`ArtistAgent` (美术师):**
* **任务：** 操作即梦网页版。
* **难点攻克：**
* **幽灵按钮：** 即梦有两个生成按钮（一个隐藏一个显示），通过 `button[class*='submit-button'] >> visible=true` 解决。
* **输入污染：** 必须使用 `Meta+A` + `Backspace` 彻底清空旧 Prompt，防止内容叠加。
* **生成确认：** 放弃单纯的 `count` 变化检测，采用“首图 URL 指纹对比法”确保下载的是最新生成的图。




4. **`PublisherAgent` (发布员):**
* **任务：** 操作小红书创作中心。
* **亮点：** 集成了 `_robust_find`，先试静态选择器，失败则呼叫 AI 视觉定位。



### 3.3 维修工 (RecoveryAgent) —— 系统之光

这是本项目最激进的设计。

* **常规模式：** 刷新页面、按 ESC 关闭弹窗。
* **上帝模式 (God Mode):**
* 当抛出 `RuntimeError` (如“找不到图文Tab”) 时：
* **Step 1:** 获取当前 HTML。
* **Step 2:** 询问 GLM-4：“当前页面想切换图文Tab但失败了，请给我一段 Python 代码修复它。”
* **Step 3:** 动态 `exec()` 执行 AI 生成的代码（例如：自动去点击那个被折叠的 Tab 按钮）。



---

## 4. 关键问题与解决方案复盘 (Troubleshooting Log)

在开发过程中，我们遇到了几个典型障碍，解决方案极具参考价值：

| 问题现象 | 根本原因 | 解决方案 | 技术标签 |
| --- | --- | --- | --- |
| **即梦生成按钮点击超时** | 页面存在两个 `submit-button`，第一个是隐藏的 (`collapsed`)，Playwright 默认抓取第一个导致无法点击。 | 使用 Playwright 伪类 `>> visible=true` 强制过滤可见元素。 | **Selector** |
| **生图内容文不对题** | 即梦输入框不会自动清空，第二次 `fill` 只是追加文本，导致 Prompt 污染。 | 模拟键盘 `Meta+A` (Mac) 或 `Ctrl+A` (Win) + `Backspace` 进行物理清空。 | **Interaction** |
| **小红书发布找不到上传框** | 默认进入的是“视频笔记”Tab，DOM 中没有图片上传入口。 | **L4 自愈：** 抛出异常，让 RecoveryAgent 动态生成“点击图文笔记 Tab”的代码并执行。 | **Agentic Workflow** |
| **评论框无法输入** | 评论框未点击时只是一个 `div` 占位符，点击后才变成 `textarea`。 | 改为“两步走”策略：先点击占位符激活，再寻找输入框 `type` 内容。 | **DOM Logic** |
| **AI 识别 DOM 耗时过长** | 原始 HTML 太大，包含大量 base64 图片和 js 代码。 | 开发 `SmartLocator`，使用 BeautifulSoup 清洗标签和属性，只保留交互骨架。 | **Optimization** |

---

## 5. 当前项目状态与风险

### ✅ 已完成

1. **浏览闭环：** 自动刷贴、概率互动、评论、素材采集。
2. **创作闭环：** 自动选题、文案生成、即梦生图、图片下载、草稿归档。
3. **发布基础：** 发布页面的自动填单、上传。
4. **容错机制：** 基础的重试与高级的 AI 代码修复。

### ⚠️ 风险点

1. **Google/即梦 风控：** 长期高频操作可能导致账号被弹滑块。虽然有检测机制，但仍需人工偶尔介入。
2. **小红书图文去重：** 纯 AI 生成的图片可能被判定为非原创。建议在上传前加入 `PIL` 图片噪点处理或滤镜。
3. **成本问题：** `SmartLocator` 和 `RecoveryAgent` 每次调用都会消耗 Token，需控制触发频率。

---

## 6. 下一步计划 (Roadmap)

### Phase 2.3: 调度与集成 (The Scheduler)

* **目标：** 将上述散落的模块（浏览、创作、发布）串联起来，形成 24 小时无人值守循环。
* **逻辑：**
* `09:00 - 18:00`: 纯浏览模式 (Interaction)，每小时刷 15 分钟，积累素材。
* `19:00`: 创作模式 (Writer + Artist)，生成 1 篇草稿。
* `20:00`: 发布模式 (Publisher)，将草稿发出。



### Phase 3.0: 视觉感知升级 (Vision)

* **目标：** 让 Momo 真的“看懂”图片。
* **动作：** 在浏览时，不仅提取文本，还将帖子图片发给 GLM-4V 进行视觉理解，从而发表针对图片的评论（例如：“你这个桌面的灯光布局很棒，用的什么灯带？”）。

---

**文档结语：**
SiliconMomo 已经从一个简单的自动化脚本，进化为了一个具备“生存智慧”的数字生命体。它不再死板地执行指令，而是开始尝试理解环境、使用工具、甚至自我修复。接下来的重点是**稳定性测试**与**内容质量的微调**。