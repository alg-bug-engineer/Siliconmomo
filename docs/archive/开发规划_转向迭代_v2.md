# SiliconMomo è½¬å‘è¿­ä»£å¼€å‘è§„åˆ’ v2.0

> **æ ¸å¿ƒç†è§£ä¿®æ­£**ï¼šè¿™æ˜¯å‡çº§è½¬å‘ï¼Œä¸æ˜¯ç®€åŒ–é™çº§ï¼
> - ä¿ç•™çŸ¥è¯†åº“ç³»ç»Ÿï¼ˆè®°å½•é«˜è´¨é‡æƒ…æ„Ÿå¸–å­ï¼‰
> - ä¿ç•™RAGé€»è¾‘ï¼ˆå‚è€ƒç´ æåˆ›ä½œï¼‰
> - æ”¹å˜æœç´¢å…³é”®è¯ï¼ˆæŠ€æœ¯â†’æƒ…æ„Ÿï¼‰
> - æ”¹å˜åˆ›ä½œé£æ ¼ï¼ˆæŠ€æœ¯ç­–å±•â†’å‘ç–¯æ–‡å­¦/å…±æƒ…æ–‡æ¡ˆï¼‰
> - æ”¹å˜é…å›¾é£æ ¼ï¼ˆæŠ€æœ¯å›¾â†’æ–‡è‰ºé£/å‘ç–¯é£ï¼‰
> - **æ•´åˆåˆ›ä½œ+å‘å¸–åˆ°ä¸»å¾ªç¯**ï¼ˆæœç´¢â†’æµè§ˆâ†’è®°å½•â†’åˆ›ä½œâ†’å‘å¸–â†’ç»§ç»­ï¼‰
> - **åŠ å¼ºå®¹é”™æ€§**ï¼ˆç»´ä¿®å·¥æŒç»­ä¿®å¤ï¼Œ24-72å°æ—¶è¿è¥ï¼‰

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

### 1. æŒç»­è¿è¥å¾ªç¯
**çœŸå®ç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿ**ï¼š
```
æœç´¢"å‘ç–¯æ–‡å­¦" â†’ æµè§ˆå¸–å­ â†’ è®°å½•é«˜è´¨é‡ç´ æ â†’ åˆ›ä½œï¼ˆç”Ÿå›¾+å†™æ–‡ï¼‰ â†’ å‘å¸– â†’ ç»§ç»­æµè§ˆ â†’ å¾ªç¯...
```

### 2. 24-72å°æ—¶æ— äººå€¼å®ˆ
- ç»´ä¿®å·¥æŒç»­ä¿®å¤ï¼Œä¸èƒ½æŠ¥é”™å°±é€€å‡º
- ç§»é™¤"3æ¬¡å¤±è´¥å°±é€€å‡º"çš„åƒåœ¾é€»è¾‘
- å®ç°çœŸæ­£çš„æŒç»­æ€§è¿è¥

### 3. å‡çº§è½¬å‘ï¼ˆéç®€åŒ–ï¼‰
- **ä¿ç•™**ï¼šçŸ¥è¯†åº“ç³»ç»Ÿã€RAGé€»è¾‘ã€åˆ›ä½œæµç¨‹
- **æ”¹å˜**ï¼šæœç´¢å…³é”®è¯ã€åˆ›ä½œé£æ ¼ã€é…å›¾é£æ ¼
- **æ•´åˆ**ï¼šåˆ›ä½œ+å‘å¸–åˆ°ä¸»å¾ªç¯

---

## ğŸ“Š å½“å‰æ¶æ„åˆ†æ

### âœ… å·²æœ‰ä¼˜åŠ¿
- **Supervisorå¾ªç¯**ï¼šå·²æœ‰ä¸»å¾ªç¯æ¡†æ¶
- **çŸ¥è¯†åº“ç³»ç»Ÿ**ï¼š`KnowledgeBase` è®°å½•ç´ æ
- **åˆ›ä½œæµç¨‹**ï¼š`WriterAgent` åŸºäºç´ æä»¿å†™
- **ç»´ä¿®å·¥**ï¼š`RecoveryAgent` è‡ªåŠ¨ä¿®å¤
- **å³æ¢¦è‡ªåŠ¨åŒ–**ï¼š`ArtistAgent` å›¾ç‰‡ç”Ÿæˆ

### âŒ éœ€è¦æ”¹é€ çš„é—®é¢˜
1. **æœç´¢å…³é”®è¯**ï¼šå½“å‰æ˜¯æŠ€æœ¯ç±»ï¼Œéœ€æ”¹ä¸ºæƒ…æ„Ÿç±»
2. **LLMåˆ†æ**ï¼šå½“å‰åˆ¤æ–­æŠ€æœ¯å†…å®¹ï¼Œéœ€æ”¹ä¸ºæƒ…æ„Ÿå†…å®¹
3. **åˆ›ä½œé£æ ¼**ï¼šå½“å‰æ˜¯æŠ€æœ¯ç­–å±•ï¼Œéœ€æ”¹ä¸ºå‘ç–¯æ–‡å­¦/å…±æƒ…æ–‡æ¡ˆ
4. **é…å›¾é£æ ¼**ï¼šå½“å‰æ˜¯æŠ€æœ¯å›¾ï¼Œéœ€æ”¹ä¸ºæ–‡è‰ºé£/å‘ç–¯é£
5. **æµç¨‹åˆ†ç¦»**ï¼šåˆ›ä½œå’Œæµè§ˆæ˜¯åˆ†ç¦»çš„ï¼Œéœ€æ•´åˆåˆ°ä¸»å¾ªç¯
6. **å®¹é”™æ€§ä¸è¶³**ï¼š3æ¬¡å¤±è´¥å°±é€€å‡ºï¼Œéœ€æŒç»­ä¿®å¤

---

## ğŸ“‹ è¯¦ç»†å¼€å‘ä»»åŠ¡æ¸…å•

### ä»»åŠ¡1ï¼šä¿®æ”¹æœç´¢å…³é”®è¯é…ç½® â­â­â­

**æ–‡ä»¶**ï¼š`config/settings.py`

**ä¿®æ”¹ç‚¹**ï¼š
```python
# === ğŸ¯ ç›®æ ‡é¢†åŸŸä¸æœç´¢ ===
# ä»æŠ€æœ¯ç±»æ”¹ä¸ºæƒ…æ„Ÿç±»
TARGET_TOPICS = ["å‘ç–¯æ–‡å­¦", "å…±æƒ…æ–‡æ¡ˆ", "æ²»æ„ˆæ–‡æ¡ˆ", "æƒ…ç»ªä»·å€¼", "emoæ–‡æ¡ˆ", "æ·±å¤œemo", "æ‰“å·¥äººæ–‡æ¡ˆ"]

# æœç´¢å…³é”®è¯æ±  - è½¬å‘æƒ…æ„Ÿç±»å†…å®¹
SEARCH_KEYWORDS = [
    "å‘ç–¯æ–‡å­¦", "å…±æƒ…æ–‡æ¡ˆ", "æ²»æ„ˆæ–‡æ¡ˆ", 
    "æ·±å¤œemo", "æ‰“å·¥äººæ–‡æ¡ˆ", "æ²»æ„ˆç³»æ–‡æ¡ˆ",
    "æƒ…ç»ªä»·å€¼", "æ™šå®‰æ–‡æ¡ˆ", "æ‰å¿ƒæ–‡æ¡ˆ",
    "æ‹çˆ±è„‘", "äººé—´æ¸…é†’", "ç‹¬å±…ç”Ÿæ´»"
]
```

---

### ä»»åŠ¡2ï¼šæ”¹é€ LLMåˆ†æé€»è¾‘ â­â­â­

**æ–‡ä»¶**ï¼š`core/llm_client.py`

**ä¿®æ”¹ç‚¹**ï¼š
```python
def analyze_and_comment(self, title, content):
    prompt = f"""
    ä½ æ˜¯ä¸€ä¸ªæ´»è·ƒåœ¨å°çº¢ä¹¦çš„æƒ…æ„Ÿåšä¸»"Momo"ï¼Œä½ çš„ä¸“å®¶äººè®¾æ˜¯ï¼šæ“…é•¿å‘ç–¯æ–‡å­¦ã€å…±æƒ…æ–‡æ¡ˆã€æ²»æ„ˆæ–‡æ¡ˆçš„æƒ…æ„Ÿåšä¸»ã€‚
    
    ã€ä»»åŠ¡ç›®æ ‡ã€‘
    åˆ†æç»™å®šçš„å¸–å­å†…å®¹ï¼Œåˆ¤æ–­æ˜¯å¦å€¼å¾—äº’åŠ¨å’Œæ”¶è—ä½œä¸ºç´ æï¼Œå¦‚æœå€¼å¾—ï¼Œç”Ÿæˆä¸€æ¡çœŸå®çš„ã€å£è¯­åŒ–çš„è¯„è®ºã€‚
    
    ã€åˆ¤æ–­æ ‡å‡†ã€‘
    1. å¸–å­å¿…é¡»å±äºä»¥ä¸‹é¢†åŸŸä¹‹ä¸€ï¼š{", ".join(TARGET_TOPICS)}ã€‚å¦‚æœå¸–å­æ˜¯æ— å…³çš„ï¼ˆå¦‚æŠ€æœ¯ã€ç©¿æ­ã€å¨±ä¹ï¼‰ï¼Œè¯·æ ‡è®°ä¸ºä¸ç›¸å…³ã€‚
    2. å¦‚æœå¸–å­æ­£æ–‡æ–‡å­—å¤ªå°‘ï¼ˆå°‘äº10ä¸ªå­—ï¼‰ï¼Œæˆ–è€…æ˜¯çº¯å›¾ç‰‡æ— æ„ä¹‰å†…å®¹ï¼Œè¯·æ ‡è®°ä¸ºä¸éœ€è¦è¯„è®ºã€‚
    3. **é«˜è´¨é‡æ ‡å‡†**ï¼šæ–‡æ¡ˆæœ‰æ„ŸæŸ“åŠ›ã€æƒ…ç»ªåˆ°ä½ã€æœ‰å…±é¸£ç‚¹ã€é€‚åˆä»¿å†™åˆ›ä½œ
    
    ã€å¸–å­ä¿¡æ¯ã€‘
    æ ‡é¢˜ï¼š{title}
    æ­£æ–‡ï¼š{content}
    
    ã€è¾“å‡ºè¦æ±‚ã€‘
    è¯·ä»…è¿”å›ä¸€ä¸ªæ ‡å‡†çš„ JSON æ ¼å¼å­—ç¬¦ä¸²ï¼š
    {{
        "is_relevant": true/false,  
        "is_high_quality": true/false,  // æ–°å¢ï¼šæ˜¯å¦é«˜è´¨é‡ç´ æ
        "should_comment": true/false, 
        "comment_text": "ä½ çš„è¯„è®ºå†…å®¹" // 50å­—ä»¥å†…ï¼Œå£è¯­åŒ–ï¼Œä¸è¦å¸¦å¼•å·
        "style_hint": "å‘ç–¯/æ²»æ„ˆ/æ¸…é†’/å…±æƒ…" // æ–°å¢ï¼šé£æ ¼æç¤ºï¼Œç”¨äºåç»­åˆ›ä½œ
    }}
    """
```

**å…³é”®å˜åŒ–**ï¼š
- äººè®¾ä»"æŠ€æœ¯è¾¾äºº"æ”¹ä¸º"æƒ…æ„Ÿåšä¸»"
- åˆ¤æ–­æ ‡å‡†ä»æŠ€æœ¯å†…å®¹æ”¹ä¸ºæƒ…æ„Ÿå†…å®¹
- æ–°å¢ `is_high_quality` æ ‡è®°é«˜è´¨é‡ç´ æ
- æ–°å¢ `style_hint` ç”¨äºåç»­åˆ›ä½œå‚è€ƒ

---

### ä»»åŠ¡3ï¼šæ”¹é€ WriterAgentåˆ›ä½œé£æ ¼ â­â­â­

**æ–‡ä»¶**ï¼š`core/writer.py`

**ä¿®æ”¹ç‚¹**ï¼š`write_from_inspiration()` æ–¹æ³•çš„Prompt

```python
def write_from_inspiration(self, inspiration):
    ref_title = inspiration.get("title", "")
    ref_content = inspiration.get("content", "")
    style_hint = inspiration.get("ai_analysis", {}).get("style_hint", "å…±æƒ…")  # ä»ç´ æä¸­æå–é£æ ¼
    
    # æ„å»ºä»¿å†™ Prompt - è½¬å‘æƒ…æ„Ÿé£æ ¼
    prompt = f"""
ä½ æ˜¯ä¸€ä¸ªå°çº¢ä¹¦æƒ…æ„Ÿåšä¸»"Momo"ï¼Œæ“…é•¿å‘ç–¯æ–‡å­¦ã€å…±æƒ…æ–‡æ¡ˆã€æ²»æ„ˆæ–‡æ¡ˆã€‚

ã€ä»»åŠ¡ã€‘
åŸºäºä»¥ä¸‹å‚è€ƒç´ æï¼Œåˆ›ä½œä¸€ç¯‡é£æ ¼ç›¸ä¼¼ä½†å†…å®¹åŸåˆ›çš„å°çº¢ä¹¦ç¬”è®°ã€‚

ã€å‚è€ƒç´ æã€‘
æ ‡é¢˜ï¼š{ref_title}
æ­£æ–‡ï¼š{ref_content[:800]}
é£æ ¼æç¤ºï¼š{style_hint}

ã€åˆ›ä½œè¦æ±‚ã€‘
1. **ä»¿å†™é£æ ¼**ï¼šä¿æŒåŸç´ æçš„æƒ…ç»ªåŸºè°ƒï¼ˆ{style_hint}ï¼‰ï¼Œä½†å†…å®¹å¿…é¡»åŸåˆ›
2. **æ–‡æ¡ˆç‰¹ç‚¹**ï¼š
   - å¤šç”¨ Emojiï¼ˆğŸ˜­ğŸ’€ğŸ”¥âœ¨ğŸ’•ç­‰ï¼‰
   - å¤šç”¨çŸ­å¥ï¼Œåˆ¶é€ èŠ‚å¥æ„Ÿ
   - è¯­æ°”è¦æœ‰æ„ŸæŸ“åŠ›ï¼ˆå‘ç–¯/æ²»æ„ˆ/æ¸…é†’/å…±æƒ…ï¼‰
3. **å­—æ•°æ§åˆ¶**ï¼šæ­£æ–‡ 100-300 å­—
4. **ç»˜ç”»æç¤ºè¯**ï¼šæ ¹æ®æ–‡æ¡ˆæƒ…ç»ªç”Ÿæˆå°é¢å›¾æè¿°
   - **å‘ç–¯/emoç±»**ï¼šèµ›åšæœ‹å…‹ã€æ¨¡ç³Šæ»¤é•œã€é›¨å¤œæ°›å›´ã€é«˜å¯¹æ¯”åº¦
   - **æ²»æ„ˆ/æ¸©æš–ç±»**ï¼šç¾å¥³ä¾§å½±/èƒŒå½±ã€æš–è‰²è°ƒã€æ—¥è½/æ™¨å…‰ã€æŸ”å’Œå…‰çº¿
   - **æ¸…é†’ç±»**ï¼šç®€çº¦ç°ä»£ã€å¹²å‡€çº¿æ¡ã€è‡ªç„¶å…‰
   - **å…±æƒ…ç±»**ï¼šå¤œæ™¯ã€çª—æ™¯ã€å®¤å†…æ¸©æš–å…‰ã€å­¤ç‹¬æ°›å›´
   - æç¤ºè¯å¿…é¡»æ˜¯è‹±æ–‡ï¼ŒåŒ…å«ä¸»ä½“ã€å…‰å½±ã€é£æ ¼

ã€è¾“å‡ºæ ¼å¼ (JSON Only)ã€‘
{{
    "title": "åŸåˆ›æ ‡é¢˜ï¼ˆå¸¦emojiï¼‰",
    "content": "åŸåˆ›æ­£æ–‡...",
    "image_prompt": "English image prompt for AI art generation...",
    "style": "{style_hint}",
    "tags": ["#tag1", "#tag2", "#tag3"]
}}
"""
```

**å…³é”®å˜åŒ–**ï¼š
- ä»"æŠ€æœ¯ç­–å±•"æ”¹ä¸º"æƒ…æ„Ÿåšä¸»"
- å¼ºè°ƒEmojiã€çŸ­å¥ã€æƒ…ç»ªæ„ŸæŸ“åŠ›
- é…å›¾é£æ ¼ä»æŠ€æœ¯å›¾æ”¹ä¸ºæ–‡è‰ºé£/å‘ç–¯é£
- ä¿ç•™RAGé€»è¾‘ï¼ˆå‚è€ƒç´ æåˆ›ä½œï¼‰

---

### ä»»åŠ¡4ï¼šæ”¹é€ ArtistAgenté…å›¾é£æ ¼ â­â­

**æ–‡ä»¶**ï¼š`core/artist.py`

**å½“å‰çŠ¶æ€**ï¼šæ ¹æ®æ–‡æ¡ˆåŠ¨æ€ç”Ÿæˆå›¾ç‰‡Prompt

**æ”¹é€ æ–¹å‘**ï¼š
- **ä¿ç•™**ï¼šåŠ¨æ€ç”Ÿæˆé€»è¾‘ï¼ˆå› ä¸ºè¦æ ¹æ®æ–‡æ¡ˆæƒ…ç»ªï¼‰
- **ä¼˜åŒ–**ï¼šPromptæ¨¡æ¿åº“ï¼Œç¡®ä¿ç”Ÿæˆæ–‡è‰ºé£/å‘ç–¯é£

**å¯é€‰ä¼˜åŒ–**ï¼šåœ¨ `data/emotions.json` ä¸­ç»´æŠ¤é…å›¾é£æ ¼å‚è€ƒ
- å‘ç–¯é£ï¼šèµ›åšæœ‹å…‹ã€é›¨å¤œã€é«˜å¯¹æ¯”
- æ–‡è‰ºé£ï¼šç¾å¥³ä¾§å½±ã€æš–è‰²è°ƒã€æŸ”å’Œå…‰
- æ¸…é†’é£ï¼šç®€çº¦ç°ä»£ã€å¹²å‡€çº¿æ¡
- å…±æƒ…é£ï¼šå¤œæ™¯ã€çª—æ™¯ã€å­¤ç‹¬æ°›å›´

**å®é™…æ”¹åŠ¨**ï¼šæ— éœ€å¤§æ”¹ï¼Œåªéœ€ç¡®ä¿WriterAgentç”Ÿæˆçš„Promptç¬¦åˆé£æ ¼è¦æ±‚ã€‚

---

### ä»»åŠ¡5ï¼šæ•´åˆåˆ›ä½œ+å‘å¸–åˆ°ä¸»å¾ªç¯ â­â­â­

**æ–‡ä»¶**ï¼š`actions/interaction.py` æˆ– `core/supervisor.py`

**å½“å‰é—®é¢˜**ï¼š
- `main.py` è¿è¡Œæµè§ˆäº’åŠ¨å¾ªç¯
- `run_creation.py` æ˜¯ç‹¬ç«‹çš„åˆ›ä½œæµç¨‹
- ä¸¤è€…åˆ†ç¦»ï¼Œæ— æ³•å½¢æˆé—­ç¯

**æ”¹é€ æ–¹æ¡ˆAï¼šåœ¨ActionExecutorä¸­æ•´åˆ**

åœ¨ `ActionExecutor.execute_one_cycle()` ä¸­ï¼š
```python
async def execute_one_cycle(self):
    # 1. æœç´¢è½®è½¬
    if self.posts_processed_count > 0 and self.posts_processed_count % SEARCH_INTERVAL == 0:
        await self._rotate_search()
    
    # 2. æµè§ˆå¸–å­ï¼ˆç°æœ‰é€»è¾‘ï¼‰
    await self._browse_and_interact()
    
    # 3. ã€æ–°å¢ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›ä½œ
    if self.kb.should_create_content():
        await self._create_and_publish()
    
    self.posts_processed_count += 1
```

**æ”¹é€ æ–¹æ¡ˆBï¼šåœ¨Supervisorä¸­æ•´åˆï¼ˆæ¨èï¼‰**

åœ¨ `Supervisor.start_shift()` ä¸­ï¼š
```python
async def start_shift(self):
    """å¼€å§‹è½®ç­ - æŒç»­è¿è¥å¾ªç¯"""
    start_time = time.time()
    self.recorder.log("info", "ğŸ‘¨â€âœˆï¸ [è½¦é—´ä¸»ä»»] 24å°æ—¶è¿è¥å¯åŠ¨")
    
    # åˆå§‹åŒ–åˆ›ä½œç›¸å…³Agent
    writer = WriterAgent(self.recorder)
    artist = ArtistAgent(self.bm.page, self.recorder)
    publisher = PublisherAgent(self.bm.page, self.recorder)  # éœ€è¦å°è£…
    
    while time.time() - start_time < self.max_duration:
        try:
            # === æ¨¡å¼1ï¼šæµè§ˆäº’åŠ¨ï¼ˆä¸»è¦æ—¶é—´ï¼‰ ===
            await self.executor.execute_one_cycle()
            
            # === æ¨¡å¼2ï¼šåˆ›ä½œå‘å¸–ï¼ˆæ¡ä»¶è§¦å‘ï¼‰ ===
            kb = self.executor.kb
            if kb.should_create_content():  # ç´ æç§¯ç´¯åˆ°é˜ˆå€¼
                await self._create_and_publish_cycle(writer, artist, publisher)
            
            # æˆåŠŸæ‰§è¡Œï¼Œé‡ç½®æ•…éšœè®¡æ•°
            self.consecutive_failures = 0
            await asyncio.sleep(random.uniform(2, 5))
            
        except Exception as e:
            # ç»´ä¿®å·¥ä»‹å…¥ï¼ˆè§ä»»åŠ¡6ï¼‰
            await self._handle_error(e)
    
async def _create_and_publish_cycle(self, writer, artist, publisher):
    """åˆ›ä½œ+å‘å¸–æµç¨‹"""
    # 1. ä»ç´ æåº“é€‰ä¸€ä¸ªé«˜è´¨é‡ç´ æ
    inspiration, _ = writer.pick_inspiration()
    if not inspiration:
        return
    
    # 2. åˆ›ä½œæ–‡æ¡ˆ
    draft = writer.write_from_inspiration(inspiration)
    if not draft:
        return
    
    # 3. ç”Ÿå›¾
    await artist.open_studio()
    image_path = await artist.generate_image(draft['image_prompt'])
    if not image_path:
        return
    
    # 4. ä¿å­˜è‰ç¨¿
    writer.save_draft(draft, image_path)
    
    # 5. å‘å¸–ï¼ˆå¯é€‰ï¼šç«‹å³å‘å¸ƒæˆ–å»¶è¿Ÿå‘å¸ƒï¼‰
    if should_publish_now():
        await publisher.publish_draft(draft)
        writer.mark_draft_published(draft['created_at'])
```

**æ¨èæ–¹æ¡ˆB**ï¼Œå› ä¸ºï¼š
- Supervisorè´Ÿè´£æ•´ä½“è°ƒåº¦
- ä¿æŒActionExecutorèŒè´£å•ä¸€ï¼ˆæµè§ˆäº’åŠ¨ï¼‰
- æ›´å®¹æ˜“æ§åˆ¶åˆ›ä½œé¢‘ç‡

---

### ä»»åŠ¡6ï¼šåŠ å¼ºå®¹é”™æ€§ - ç§»é™¤é€€å‡ºé€»è¾‘ â­â­â­

**æ–‡ä»¶**ï¼š`core/supervisor.py`

**å½“å‰é—®é¢˜**ï¼š
```python
# 1. ç†”æ–­æ£€æŸ¥ï¼šå¦‚æœè¿ç»­å¤±è´¥è¶…è¿‡ 3 æ¬¡ï¼Œå¼ºåˆ¶åœæ­¢
if self.consecutive_failures >= self.MAX_RETRIES:
    self.recorder.log("critical", "ğŸ”¥ [ç†”æ–­] è¿ç»­æ•…éšœæ¬¡æ•°è¿‡å¤šï¼Œæ”¾å¼ƒä¿®å¤ï¼Œç»“æŸå½“å‰ Session")
    break
```

**æ”¹é€ æ–¹æ¡ˆ**ï¼š
```python
async def start_shift(self):
    """å¼€å§‹è½®ç­ - æŒç»­è¿è¥ï¼Œæ°¸ä¸æ”¾å¼ƒ"""
    start_time = time.time()
    self.recorder.log("info", "ğŸ‘¨â€âœˆï¸ [è½¦é—´ä¸»ä»»] 24å°æ—¶è¿è¥å¯åŠ¨ï¼Œç»´ä¿®å·¥å¾…å‘½")
    
    # ç§»é™¤ MAX_RETRIES é™åˆ¶ï¼Œæ”¹ä¸º"æŒç»­ä¿®å¤æ¨¡å¼"
    # self.MAX_RETRIES = 3  # åˆ é™¤è¿™è¡Œ
    
    while time.time() - start_time < self.max_duration:
        try:
            # æ­£å¸¸ä½œä¸š
            await self.executor.execute_one_cycle()
            self.consecutive_failures = 0
            await asyncio.sleep(random.uniform(2, 5))
            
        except KeyboardInterrupt:
            # åªæœ‰ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­æ‰é€€å‡º
            self.recorder.log("warning", "ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­")
            break
            
        except Exception as e:
            # === å¼‚å¸¸å¤„ç†ï¼šæŒç»­ä¿®å¤æ¨¡å¼ ===
            self.consecutive_failures += 1
            self.recorder.log("error", f"ğŸš¨ å¼‚å¸¸å‘ç”Ÿ (è¿ç»­ç¬¬ {self.consecutive_failures} æ¬¡): {e}")
            
            # è‡´å‘½ä¼¤æ£€æŸ¥ï¼ˆåªæœ‰æµè§ˆå™¨æ–­å¼€æ‰æ”¾å¼ƒï¼‰
            if "Target closed" in str(e) or "Session closed" in str(e):
                self.recorder.log("critical", "ğŸ’€ æµè§ˆå™¨å·²æ–­å¼€ï¼Œæ— æ³•ç»§ç»­")
                break
            
            # å‘¼å«ç»´ä¿®å·¥ï¼ˆæŒç»­ä¿®å¤ï¼Œä¸è®¾ä¸Šé™ï¼‰
            is_fixed = await self.recovery.diagnose_and_fix(e)
            
            if is_fixed:
                self.recorder.log("info", "âœ… ç»´ä¿®æˆåŠŸï¼Œç»§ç»­è¿è¥")
                self.consecutive_failures = 0  # é‡ç½®è®¡æ•°ï¼Œç»™æœºä¼š
                await asyncio.sleep(2)
                continue
            else:
                # ç»´ä¿®å¤±è´¥ï¼Œä½†ä¸é€€å‡ºï¼Œè€Œæ˜¯ï¼š
                # 1. ç­‰å¾…æ›´é•¿æ—¶é—´
                # 2. å°è¯•åˆ·æ–°é¡µé¢
                # 3. ç»§ç»­å¾ªç¯
                self.recorder.log("warning", "âš ï¸ ç»´ä¿®å¤±è´¥ï¼Œæ‰§è¡Œæ·±åº¦æ¢å¤...")
                await self._deep_recovery()
                await asyncio.sleep(10)  # ç­‰å¾…æ›´é•¿æ—¶é—´
                continue  # ç»§ç»­å¾ªç¯ï¼Œä¸é€€å‡º
    
async def _deep_recovery(self):
    """æ·±åº¦æ¢å¤ï¼šåˆ·æ–°é¡µé¢ã€é‡æ–°åˆå§‹åŒ–"""
    try:
        await self.bm.page.reload()
        await self.bm.page.wait_for_load_state("domcontentloaded")
        await asyncio.sleep(3)
        # ç¡®ä¿å›åˆ°å°çº¢ä¹¦é¦–é¡µ
        if "xiaohongshu.com" not in self.bm.page.url:
            await self.bm.page.goto(BASE_URL)
        self.recorder.log("info", "ğŸ”„ æ·±åº¦æ¢å¤å®Œæˆï¼Œç¯å¢ƒå·²é‡ç½®")
    except Exception as e:
        self.recorder.log("error", f"æ·±åº¦æ¢å¤å¤±è´¥: {e}")
```

**å…³é”®å˜åŒ–**ï¼š
- ç§»é™¤ `MAX_RETRIES` é™åˆ¶
- åªæœ‰æµè§ˆå™¨æ–­å¼€æˆ–ç”¨æˆ·ä¸­æ–­æ‰é€€å‡º
- ç»´ä¿®å¤±è´¥åæ‰§è¡Œæ·±åº¦æ¢å¤ï¼Œç»§ç»­å¾ªç¯
- å®ç°çœŸæ­£çš„24-72å°æ—¶æŒç»­è¿è¥

---

### ä»»åŠ¡7ï¼šä¼˜åŒ–çŸ¥è¯†åº“ - æ ‡è®°é«˜è´¨é‡ç´ æ â­â­

**æ–‡ä»¶**ï¼š`core/knowledge_base.py`

**ä¿®æ”¹ç‚¹**ï¼š
```python
def save_inspiration(self, title, content, analysis_result, source_url="", image_urls=None):
    # ... ç°æœ‰é€»è¾‘ ...
    
    new_record = {
        # ... ç°æœ‰å­—æ®µ ...
        "ai_analysis": {
            "is_relevant": analysis_result.get("is_relevant"),
            "is_high_quality": analysis_result.get("is_high_quality", False),  # æ–°å¢
            "generated_comment": analysis_result.get("comment_text"),
            "style_hint": analysis_result.get("style_hint", "")  # æ–°å¢
        },
        "status": "unused"
    }
```

**æ–°å¢æ–¹æ³•**ï¼š
```python
def should_create_content(self):
    """åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ›ä½œæ–°å†…å®¹"""
    high_quality_count = len([
        item for item in self._load_data() 
        if item.get("ai_analysis", {}).get("is_high_quality") and item.get("status") == "unused"
    ])
    return high_quality_count >= 3  # ç§¯ç´¯3ä¸ªé«˜è´¨é‡ç´ æååˆ›ä½œ
```

---

### ä»»åŠ¡8ï¼šå°è£…PublisherAgent â­â­

**æ–‡ä»¶**ï¼š`actions/publisher.py` æˆ–æ–°å»º `core/publisher.py`

**å½“å‰çŠ¶æ€**ï¼š`XiaohongshuPoster` æ˜¯ä¸€ä¸ªç‹¬ç«‹ç±»ï¼Œéœ€è¦å°è£…ä¸ºAgent

**æ”¹é€ æ–¹æ¡ˆ**ï¼š
```python
class PublisherAgent:
    def __init__(self, page, recorder):
        self.page = page
        self.recorder = recorder
        self.poster = XiaohongshuPoster()  # å¤ç”¨ç°æœ‰é€»è¾‘
    
    async def publish_draft(self, draft):
        """å‘å¸ƒè‰ç¨¿"""
        title = draft.get("title", "")
        content = draft.get("content", "")
        image_path = draft.get("image_local_path", "")
        
        try:
            await self.poster.post_article(
                title=title,
                content=content,
                images=[image_path] if image_path else None
            )
            self.recorder.log("success", f"ğŸ“¤ å‘å¸ƒæˆåŠŸ: ã€Š{title}ã€‹")
            return True
        except Exception as e:
            self.recorder.log("error", f"ğŸ“¤ å‘å¸ƒå¤±è´¥: {e}")
            return False
```

---

## ğŸ”„ å®Œæ•´è¿è¥å¾ªç¯è®¾è®¡

### å¾ªç¯æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supervisor.start_shift() - 24å°æ—¶è¿è¥å¾ªç¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ æµè§ˆäº’åŠ¨ â”‚            â”‚ åˆ›ä½œå‘å¸–  â”‚
   â”‚ (ä¸»è¦)  â”‚            â”‚ (æ¡ä»¶è§¦å‘)â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚ æœç´¢"å‘ç–¯æ–‡å­¦"         â”‚ ä»ç´ æåº“é€‰
        â”‚ æµè§ˆå¸–å­              â”‚ åˆ›ä½œæ–‡æ¡ˆ
        â”‚ è®°å½•é«˜è´¨é‡ç´ æ         â”‚ ç”Ÿå›¾
        â”‚ ç‚¹èµ/è¯„è®º/æ”¶è—         â”‚ å‘å¸–
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ç»´ä¿®å·¥ä¿®å¤     â”‚
            â”‚  (æŒç»­ä¿®å¤)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ç»§ç»­å¾ªç¯      â”‚
            â”‚  (ä¸é€€å‡º)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¶é—´åˆ†é…
- **90%æ—¶é—´**ï¼šæµè§ˆäº’åŠ¨ï¼ˆæœç´¢â†’æµè§ˆâ†’è®°å½•ç´ æï¼‰
- **10%æ—¶é—´**ï¼šåˆ›ä½œå‘å¸–ï¼ˆç§¯ç´¯3ä¸ªé«˜è´¨é‡ç´ æåè§¦å‘ï¼‰

### å®¹é”™æœºåˆ¶
- ä»»ä½•é”™è¯¯ â†’ ç»´ä¿®å·¥ä»‹å…¥ â†’ ä¿®å¤ â†’ ç»§ç»­å¾ªç¯
- åªæœ‰æµè§ˆå™¨æ–­å¼€æˆ–ç”¨æˆ·ä¸­æ–­æ‰é€€å‡º

---

## ğŸ“ å®æ–½æ­¥éª¤

### Step 1: é…ç½®ä¿®æ”¹ï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] ä¿®æ”¹ `config/settings.py`ï¼šæœç´¢å…³é”®è¯æ”¹ä¸ºæƒ…æ„Ÿç±»
- [ ] æµ‹è¯•æœç´¢åŠŸèƒ½

### Step 2: LLMåˆ†ææ”¹é€ ï¼ˆ1å°æ—¶ï¼‰
- [ ] ä¿®æ”¹ `core/llm_client.py`ï¼šæ”¹ä¸ºæƒ…æ„Ÿåšä¸»äººè®¾
- [ ] æ–°å¢ `is_high_quality` å’Œ `style_hint` å­—æ®µ
- [ ] æµ‹è¯•åˆ†æé€»è¾‘

### Step 3: åˆ›ä½œé£æ ¼æ”¹é€ ï¼ˆ1-2å°æ—¶ï¼‰
- [ ] ä¿®æ”¹ `core/writer.py`ï¼šPromptæ”¹ä¸ºæƒ…æ„Ÿé£æ ¼
- [ ] æµ‹è¯•åˆ›ä½œæ•ˆæœ

### Step 4: æ•´åˆåˆ›ä½œåˆ°ä¸»å¾ªç¯ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] åœ¨ `Supervisor` ä¸­æ•´åˆåˆ›ä½œæµç¨‹
- [ ] å°è£… `PublisherAgent`
- [ ] æµ‹è¯•å®Œæ•´å¾ªç¯

### Step 5: åŠ å¼ºå®¹é”™æ€§ï¼ˆ1-2å°æ—¶ï¼‰
- [ ] ç§»é™¤ `MAX_RETRIES` é™åˆ¶
- [ ] å®ç°æ·±åº¦æ¢å¤æœºåˆ¶
- [ ] æµ‹è¯•æŒç»­è¿è¥

### Step 6: ä¼˜åŒ–çŸ¥è¯†åº“ï¼ˆ30åˆ†é’Ÿï¼‰
- [ ] æ–°å¢ `should_create_content()` æ–¹æ³•
- [ ] æ ‡è®°é«˜è´¨é‡ç´ æ

### Step 7: ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆ2-3å°æ—¶ï¼‰
- [ ] æµ‹è¯•24å°æ—¶è¿è¥å¾ªç¯
- [ ] éªŒè¯ç»´ä¿®å·¥æŒç»­ä¿®å¤
- [ ] éªŒè¯åˆ›ä½œ+å‘å¸–æµç¨‹

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- âœ… 24å°æ—¶æŒç»­è¿è¥æ— ä¸­æ–­ï¼ˆé™¤æµè§ˆå™¨æ–­å¼€ï¼‰
- âœ… ç»´ä¿®å·¥ä¿®å¤æˆåŠŸç‡ > 80%
- âœ… åˆ›ä½œ+å‘å¸–æˆåŠŸç‡ > 85%

### ä¸šåŠ¡æŒ‡æ ‡
- ğŸ“Š æ¯æ—¥ç§¯ç´¯é«˜è´¨é‡ç´ æ > 10æ¡
- ğŸ“Š æ¯æ—¥åˆ›ä½œ+å‘å¸– > 1ç¯‡
- ğŸ“Š å•ç¯‡ç¬”è®°æµè§ˆé‡ > 50ï¼ˆåˆæœŸç›®æ ‡ï¼‰

---

## âš ï¸ é£é™©ä¸åº”å¯¹

### é£é™©1ï¼šå°çº¢ä¹¦é£æ§
**åº”å¯¹**ï¼š
- ä¿æŒHumanMotionæ‹ŸäººåŒ–
- æ§åˆ¶å‘å¸ƒé¢‘ç‡ï¼ˆæ¯æ—¥1-3ç¯‡ï¼‰
- éšæœºåŒ–è¡Œä¸ºæ—¶é—´

### é£é™©2ï¼šå³æ¢¦ç”Ÿå›¾ä¸ç¨³å®š
**åº”å¯¹**ï¼š
- RecoveryAgentè‡ªåŠ¨ä¿®å¤
- ç”Ÿå›¾å¤±è´¥æ—¶è·³è¿‡ï¼Œç»§ç»­å¾ªç¯

### é£é™©3ï¼šç´ æè´¨é‡ä¸ä½³
**åº”å¯¹**ï¼š
- LLMåˆ¤æ–­ `is_high_quality`
- äººå·¥å®šæœŸç­›é€‰ä¼˜è´¨Prompt

---

## ğŸ“š ç›¸å…³æ–‡ä»¶æ¸…å•

### å¿…é¡»ä¿®æ”¹
- `config/settings.py` â­â­â­
- `core/llm_client.py` â­â­â­
- `core/writer.py` â­â­â­
- `core/supervisor.py` â­â­â­
- `core/knowledge_base.py` â­â­

### éœ€è¦æ–°å»º/å°è£…
- `core/publisher.py` æˆ–æ”¹é€  `actions/publisher.py` â­â­

### å¯é€‰ä¼˜åŒ–
- `core/artist.py`ï¼ˆé…å›¾é£æ ¼ä¼˜åŒ–ï¼‰
- `data/emotions.json`ï¼ˆé£æ ¼å‚è€ƒåº“ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šä¿®æ”¹æœç´¢å…³é”®è¯é…ç½®
2. **å¹¶è¡Œå¼€å‘**ï¼šæ”¹é€ LLMåˆ†æ + åˆ›ä½œé£æ ¼
3. **æ ¸å¿ƒæ•´åˆ**ï¼šæ•´åˆåˆ›ä½œ+å‘å¸–åˆ°ä¸»å¾ªç¯
4. **åŠ å¼ºå®¹é”™**ï¼šç§»é™¤é€€å‡ºé€»è¾‘ï¼Œå®ç°æŒç»­è¿è¥

---

**é¢„è®¡æ€»å·¥æ—¶**ï¼š8-12å°æ—¶  
**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š2-3å¤©ï¼ˆæŒ‰æ¯å¤©3-4å°æ—¶è®¡ç®—ï¼‰
